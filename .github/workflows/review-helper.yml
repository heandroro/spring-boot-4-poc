# .github/workflows/review-helper.yml
name: Review Helper

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Java 25
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '25'
      
      - name: Run checks (includes Checkstyle)
        run: ./gradlew check jacocoTestReport
      
      - name: Analyze with Copilot
        # Copilot faz review automaticamente
        # se configurado em .github/copilot.yml
        run: echo "Copilot review triggered"
      
      - name: Comment Summary
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "## ‚úÖ Verifica√ß√µes de Qualidade Aprovadas\n\n- ‚úÖ Build conclu√≠do\n- ‚úÖ Todos os testes passando\n- ‚úÖ Checkstyle e verifica√ß√µes est√°ticas OK\n- ‚úÖ Revis√£o do Copilot conclu√≠da\n\n**Pronto para revis√£o humana!** üëÄ\n\nSe tudo estiver OK na revis√£o do Copilot, voc√™ pode aprovar rapidamente."
            })
      
      - name: Comment check failures
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "## ‚ùå Verifica√ß√µes de Qualidade Falharam\n\nPor favor, rode './gradlew check' localmente e corrija os problemas reportados antes de enviar novamente. Causas comuns: viola√ß√µes de Checkstyle (incluindo uso de nomes totalmente qualificados). Veja CONTRIBUTING.md > \"Imports (sem nomes qualificados)\" e '.github/instructions/no-fqn.instructions.md' para orienta√ß√µes."
            })