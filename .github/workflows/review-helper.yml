# .github/workflows/review-helper.yml
name: Review Helper

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Java 25
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '25'
      
      - name: Run checks (includes Checkstyle)
        run: ./gradlew check jacocoTestReport
      
      - name: Analyze with Copilot
        # Copilot faz review automaticamente
        # se configurado em .github/copilot.yml
        run: echo "Copilot review triggered"
      
      - name: Comment Summary
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## âœ… Quality Checks Passed
              
              - âœ… Build successful
              - âœ… All tests passing
              - âœ… Checkstyle and static checks passed
              - âœ… Copilot review completed
              
              **Ready for human review!** ðŸ‘€
              
              Se tudo estiver OK no review do Copilot, vocÃª pode aprovar rapidamente.`
            })
      
      - name: Comment check failures
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## âŒ Quality Checks Failed

Please run './gradlew check' locally and fix the reported issues before pushing again. Common causes: Checkstyle violations (including use of fully-qualified class names). See CONTRIBUTING.md > "Imports (sem nomes qualificados)" and '.github/instructions/no-fqn.instructions.md' for guidance.`
            })